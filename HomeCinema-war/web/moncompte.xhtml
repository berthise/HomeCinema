<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title></title>
        <meta name="description" content=""/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <link rel="stylesheet" href="css/bootstrap.min.css"/>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
        <link rel="stylesheet" href="css/main.css"/>

        <f:metadata>
            <f:viewParam name="box" value="#{accountManagedBean.initBox}" />
            <f:event type="preRenderView" listener="#{loginManagedBean.checkConnected()}"/>
            <f:event type="preRenderView" listener="#{accountManagedBean.setIdUser(loginManagedBean.id)}"/>
        </f:metadata>

    </head>
    <body id="top">
        <ui:include src="components/header.xhtml" >
            <ui:param name="active" value="moncompte" />
        </ui:include>
        <section>
            <div class="container">
                <div class="well">
                    <h2 class="well-title">Mon compte</h2>

                    <script>
                        function display(id) {
                            document.getElementById('box-films').className = "display-none";
                            document.getElementById('link-films').className = "";
                            document.getElementById('box-caddie').className = "display-none";
                            document.getElementById('link-caddie').className = "";
                            document.getElementById('box-historique').className = "display-none";
                            document.getElementById('link-historique').className = "";
                            document.getElementById('box-infos').className = "display-none";
                            document.getElementById('link-infos').className = "";
                            document.getElementById('box-' + id).className = "box-right";
                            document.getElementById('link-' + id).className = "activated";
                            return false;
                        }
                    </script> 

                    <div id="nav">
                        <h:outputText value="#{accountManagedBean.getHtmlForLink('films', 'Mes films')}" escape="false" />
                        <h:outputText value="#{accountManagedBean.getHtmlForLink('caddie', 'Mon Caddie')}" escape="false" />
                        <h:outputText value="#{accountManagedBean.getHtmlForLink('historique', 'Mon historique')}" escape="false" />
                        <h:outputText value="#{accountManagedBean.getHtmlForLink('infos', 'Mes informations')}" escape="false" />
                    </div>

                    <div class="#{accountManagedBean.getClassDisplay('films')}" id="box-films">
                        <h3><img src="img/film-icon.png" title="Caddie"/>Films</h3>

                        <table>

                            <ui:repeat var="o" value="#{accountManagedBean.getListFilms()}" varStatus="status">

                                <c:set var="simple" value="#{o.get(0) eq 'SIMPLE'}" />
                                <c:set var="vide" value="#{o.get(0) eq 'EMPTY'}" />

                                <tr>

                                    <h:panelGroup rendered="#{vide}">
                                        <td>Votre liste de films est vide ... <a href="#">Cliquez ici pour trouver des films !</a></td>                                        
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{simple}">
                                        <td>
                                            <span class="affiche">
                                                <img src="img/glass.png" />
                                                <span>
                                                    <img src="http://image.tmdb.org/t/p/w396/#{o.get(1)}" />
                                                </span>
                                            </span>
                                        </td>
                                        <td>                 
                                            <a title="Voir la fiche du film" href="fiche_film.xhtml?id=#{o.get(4)}">#{o.get(2)} (#{o.get(3)})</a>
                                        </td>
                                        <td><a href="visionneuse.xhtml?id=#{o.get(4)}"><img src="img/eye.png" title="Voir le film" /></a></td>
                                    </h:panelGroup>

                                </tr>

                            </ui:repeat>

                        </table>
                    </div>

                    <div class="#{accountManagedBean.getClassDisplay('caddie')}" id="box-caddie">
                        <h3><img src="img/cart-icon.png" title="Caddie"/>Caddie</h3>

                        <table>

                            <ui:repeat var="o" value="#{accountManagedBean.getListCaddie()}" varStatus="status">

                                <c:set var="solo" value="#{o.get(0) eq 'SOLO'}" />
                                <c:set var="first" value="#{o.get(0) eq 'FIRST'}" />
                                <c:set var="simple" value="#{o.get(0) eq 'SIMPLE'}" />
                                <c:set var="vide" value="#{o.get(0) eq 'EMPTY'}" />

                                <tr class="tr-caddie-#{o.get(1)}">

                                    <h:panelGroup rendered="#{vide}">
                                        <td>Votre caddie est vide ... <a href="#">Cliquez ici pour trouver des films !</a></td>                                        
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{first}">
                                        <td class="td-right" rowspan="#{o.get(2) + 1}">#{o.get(5)}</td>
                                        <td class="td-invisible"></td>
                                        <td class="td-right title-film-caddie">                                                
                                            <a href="#"><b>#{o.get(3)}</b></a>
                                        </td>
                                        <td class="td-right">#{o.get(4)}€</td>
                                        <td>
                                            <h:form>
                                                <h:commandButton class="button-delete" value="" action="#{accountManagedBean.deleteFromCaddie(o.get(1))}" />
                                            </h:form>
                                        </td>

                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{simple}">
                                        <td class="td-right">
                                            <span class="affiche">
                                                <img src="img/glass.png" />
                                                <span>
                                                    <img src="http://image.tmdb.org/t/p/w396/#{o.get(3)}" />
                                                </span>
                                            </span>
                                        </td>
                                        <td class="align-left" colspan="3">                 
                                            <a title="Voir la fiche du film" href="fiche_film.xhtml?id=#{o.get(2)}">#{o.get(4)} (#{o.get(5)})</a>
                                        </td>
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{solo}">
                                        <td class="td-right">#{o.get(7)}</td>
                                        <td class="td-right">
                                            <span class="affiche">
                                                <img src="img/glass.png" />
                                                <span>
                                                    <img src="http://image.tmdb.org/t/p/w396/#{o.get(5)}" />
                                                </span>
                                            </span>
                                        </td>
                                        <td class="td-right title-film-caddie">                 
                                            <b><a title="Voir la fiche du film" href="fiche_film.xhtml?id=#{o.get(2)}">#{o.get(3)} (#{o.get(6)})</a></b>
                                        </td>
                                        <td class="td-right">#{o.get(4)}€</td>
                                        <td>
                                            <h:form>
                                                <h:commandButton class="button-delete" value="" action="#{accountManagedBean.deleteFromCaddie(o.get(1))}" />
                                            </h:form>
                                        </td>

                                    </h:panelGroup>

                                </tr>

                            </ui:repeat>

                        </table>

                        <h:panelGroup rendered="#{accountManagedBean.getListCaddie().get(0).get(0) != 'EMPTY' }">
                            <a class="btn btn-success col-md-3 b1r" href="">Valider mon caddie</a>
                        </h:panelGroup>
                    </div>

                    <div class="#{accountManagedBean.getClassDisplay('historique')}" id="box-historique">
                        <h3><img src="img/clock-icon.png" title="Caddie"/>Historique</h3>



                    </div>

                    <div class="#{accountManagedBean.getClassDisplay('infos')}" id="box-infos">
                        <h3><img src="img/info-icon.png" title="Caddie"/>Informations</h3>
                    </div>

                    <div id="bottom">
                        <a class="go-top" href="#top" title="Vers le haut"><img src="img/arrowUp.png" /></a>                        
                    </div>                        
                </div>

            </div>
        </section>
    </body>
</html>
