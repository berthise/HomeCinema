<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title>HomeCin√©ma - #{msg['menu-visio']}</title>
        <meta name="description" content=""/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <link rel="stylesheet" href="css/bootstrap.min.css"/>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
        <link rel="stylesheet" href="css/main.css"/>

        <f:metadata>
            <f:viewParam name="id" value="#{filmManagedBean.id}" />
	    <f:event type="preRenderView" listener="#{sessionManagedBean.checkRight}"/>
            <f:event type="preRenderView" listener="#{filmManagedBean.setDtoFromId()}"/>
            <f:event type="preRenderView" listener="#{accountManagedBean.checkIsMyFilm(filmManagedBean.id, sessionManagedBean.id)}"/>
        </f:metadata>

    </h:head>
    <h:body id="top">
    <ui:insert name="header" >
      <ui:include src="components/header.xhtml">
	<ui:param name="active" value="index" />
      </ui:include>
    </ui:insert>
        <section>
            <div class="container">

                <div id="ba" class="well">
                    <h2 class="well-title"><strong>#{msg['visio-subtitle']}: </strong><h:outputText value="#{filmManagedBean.getLinkToFiche()}" escape="false"/>
                        <div class="form-download-film">
                            <h:outputText value="#{filmManagedBean.getLinkToDownload()}" escape="false" />
                        </div>
                    </h2>

                    <video id="myVideo" width="100%" controls="controls" autoplay="autoplay">
		      <ui:repeat value="#{filmManagedBean.getVideos()}" var="video">
			<source src="#{video.url}" type="#{video.type}" />
		      </ui:repeat>
			#{msg['ba-not-supported']}
                    </video>
                    <h:form p:style="display: none;">
                        <h:inputText id="currentPosition" p:id="ufCP" value="#{usersFilmsManagedBean.ufdto.currentPosition}" />
                        <h:commandButton action="#{usersFilmsManagedBean.updateCurrentTime}" p:id="updateCT">
                            <f:param name="film" value="#{filmManagedBean.id}" />
                            <f:param name="user" value="#{sessionManagedBean.id}" />
                            <f:ajax execute="@form" render="output" />
                        </h:commandButton>
                    </h:form>                        
                    <h:outputText id="output" value="#{usersFilmsManagedBean.updateCurrentTime()}" />
                    #{usersFilmsManagedBean.getCurrentTime(sessionManagedBean.id, filmManagedBean.id)}
                    <span id="lastPosition" style="display: none">#{usersFilmsManagedBean.ufdto.currentPosition}</span>

		    <a class="go-top" title="#{msg['allpage-top']}" href="#top"><img src="img/arrowUp.png" /></a>

<!--		    <div>
		      <ul>
		      <ui:repeat value="#{filmManagedBean.getVideos()}" var="video">
			<li> <a onclick="changeVideo('#{video.url}','#{video.type}')" herf="#">select this video #{video.url} #{video.type}</a></li>
		      </ui:repeat>
		      </ul>
		      <script>
			function changeVideo(newUrl,type) {
			  var v = video document.getElementById("myVideo");
			  while (v.firstChild) {
			     v.removeChild(v.firstChild);
			  }
			  var s = document.createElement("source");
			  s.setAttribute("src", newUrl);
			  s.setAttribute("type", type);
			  v.appendChild(s);
			}
			</script>
		    </div>-->
                </div>
            </div>
        </section>

        <ui:insert name="footer" >
            <ui:include src="components/footer.xhtml" />
        </ui:insert>
    </h:body>

</html>
