<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
    <h:head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" />
        <title>HomeCinéma - #{msg['films-title']}</title>
        <meta name="description" content=""/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <link rel="stylesheet" href="css/bootstrap.min.css"/>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
        <link rel="stylesheet" href="css/main.css"/>
        <link rel="stylesheet" href="css/style-films.css"/>

        <f:metadata>
            <f:event type="preRenderView" listener="#{sessionManagedBean.checkRight()}"/>
            <f:viewParam name="director" value="#{searchProductsManagedBean.directorReset}" />
            <f:viewParam name="actor" value="#{searchProductsManagedBean.actorReset}" />
            <f:viewParam name="genre" value="#{searchProductsManagedBean.genreReset}" />
            <f:viewParam name="title" value="#{searchProductsManagedBean.titleReset}" />
            <f:viewParam name="tab" value="#{listProductsManagedBean.tabFilms}" />
        </f:metadata>

    </h:head>

    <h:body>
        <ui:insert name="header" >
            <ui:include src="components/header.xhtml">
                <ui:param name="active" value="films" />
            </ui:include>
        </ui:insert>

        <script>
	    function loader(id) {
		document.getElementById('loader-' + id).style.display = 'inline';
	    }
	    function handleAjaxOpen(data) {
		var status = data.status;

		switch (status) {
		    case "success":
			setTimeout(function () {
			    document.getElementById('search-attributs').style.maxHeight = '2000px';
			}, 100);
			break;
		}
	    }
	    function handleAjaxClose(data) {
		var status = data.status;
		console.log(data);

		switch (status) {
		    case "success":
			setTimeout(function () {
			    document.getElementById('search-attributs').style.maxHeight = '0px';
			}, 100);
			break;
		}
	    }
	    function clean(id) {
		document.getElementById('form-random:' + id).value = "";
		return false;
	    }
        </script>

        <section>
            <div class="container">
                <div class="row">
                    <aside class="col-lg-3 col-md-4 sidebar">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3><i class="glyphicon glyphicon-tasks" />#{msg['menu-films-criter']}</h3>
                            </div>
                            <div class="panel-body">
                                <h:form id="form-random">
                                    <ul class="nav nav-sidebar">
                                        <li>
                                            <h:commandLink onclick="javascript:loader('all');" action="#{listProductsManagedBean.setTabFilms('allLOCALE')}" class="#{((listProductsManagedBean.getTabFilms() eq 'all')? 'active' : '')}">
                                                <i class="glyphicon glyphicon-list-alt" />#{msg['films-all']}
                                                <f:actionListener binding="#{listProductsManagedBean.setPage(1)}"/>
                                                <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page" onevent="handleAjaxClose"/>
                                                <img id="loader-all" class="films-loader" src="img/loader.gif"/>
                                            </h:commandLink>
                                        </li>
                                        <li>
                                            <h:commandLink onclick="javascript:loader('pack');" action="#{listProductsManagedBean.setTabFilms('packLOCALE')}" class="#{((listProductsManagedBean.getTabFilms() eq 'pack')? 'active' : '')}">
                                                <i class="glyphicon glyphicon-book" />#{msg['search-pack']}
                                                <f:actionListener binding="#{listProductsManagedBean.setPage(1)}"/>
                                                <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page" onevent="handleAjaxClose"/>
                                                <img id="loader-pack" class="films-loader" src="img/loader.gif"/>
                                            </h:commandLink>
                                        </li>
                                        <li>
                                            <h:commandLink onclick="javascript:loader('top');" class="#{((listProductsManagedBean.getTabFilms() eq 'top')? 'active' : '')}" action="#{listProductsManagedBean.setTabFilms('topLOCALE')}">
                                                <i class="glyphicon glyphicon-heart" />#{msg['search-top10']}
                                                <f:actionListener binding="#{listProductsManagedBean.setPage(1)}"/>
                                                <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page" onevent="handleAjaxClose"/>
                                                <img id="loader-top" class="films-loader" src="img/loader.gif"/>
                                            </h:commandLink>
                                        </li>
                                        <li>
                                            <h:commandLink onclick="javascript:loader('new');" class="#{((listProductsManagedBean.getTabFilms() eq 'new')? 'active' : '')}" action="#{listProductsManagedBean.setTabFilms('newLOCALE')}">
                                                <i class="glyphicon glyphicon-bookmark" />#{msg['search-new']}
                                                <f:actionListener binding="#{listProductsManagedBean.setPage(1)}"/>
                                                <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page" onevent="handleAjaxClose"/>
                                                <img id="loader-new" class="films-loader" src="img/loader.gif"/>
                                            </h:commandLink>
                                        </li>
                                        <li>
                                            <h:commandLink onclick="javascript:loader('search');" class="#{((listProductsManagedBean.getTabFilms() eq 'search')? 'active' : '')}" action="#{listProductsManagedBean.setTabFilms('searchLOCALE')}">
                                                <i class="glyphicon glyphicon-cog" />#{msg['search-advanced']}
                                                <f:actionListener binding="#{listProductsManagedBean.setPage(1)}"/>
                                                <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page" onevent="handleAjaxOpen"/>
                                                <img id="loader-search" class="films-loader" src="img/loader.gif"/>
                                            </h:commandLink>

                                            <div class="#{((listProductsManagedBean.getTabFilms() eq 'search')? 'activated-search' : '')}" id="search-attributs" style="max-height: #{((listProductsManagedBean.searchOpened == 0)? '2000' : '0')}px;">

                                                <div class="row">
                                                    <div class="col-md-6 col-xs-5 col-no-padding-search">
                                                        <h:outputLabel class="label-search" for="title">#{msg['films-search-title']} :</h:outputLabel>
                                                    </div>
                                                    <div class="col-md-5 col-xs-6 col-no-padding-search-input">
                                                        <h:inputText class="form-control input-search" id="title" value="#{searchProductsManagedBean.title}" />
                                                    </div>
                                                    <div class="col-xs-1 col-no-padding-search">
                                                        <span class="clean" onclick="clean('title');">×</span>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6 col-xs-5 col-no-padding-search ">
                                                        <h:outputLabel class="label-search" for="date">#{msg['films-search-date']} :</h:outputLabel>
                                                    </div>
                                                    <div class="date-search col-md-5 col-xs-6 col-no-padding-search-input">
                                                        <h:inputText p:placeholder="#{msg['debut']}" style="width: 49%;" class="form-control input-search" id="date1" value="#{searchProductsManagedBean.date1}" />
                                                        <h:inputText p:placeholder="#{msg['fin']}" style="width: 49%; float: right;" class="form-control input-search" id="date2" value="#{searchProductsManagedBean.date2}" />
                                                    </div>
                                                    <div class="col-xs-1 col-no-padding-search">
							<span class="clean" onclick="clean('date1');
								clean('date2');">×</span>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6 col-xs-5 col-no-padding-search">
                                                        <h:outputLabel class="label-search" for="director">#{msg['films-search-dir']} :</h:outputLabel>
                                                    </div>
                                                    <div class="col-md-5 col-xs-6 col-no-padding-search-input">
                                                        <h:inputText class="form-control input-search" id="director" value="#{searchProductsManagedBean.director}" />
                                                    </div>
                                                    <div class="col-xs-1 col-no-padding-search">
                                                        <span class="clean" onclick="clean('director');">×</span>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6 col-xs-5 col-no-padding-search">
                                                        <h:outputLabel class="label-search" for="actor">#{msg['films-search-act']} :</h:outputLabel>
                                                    </div>
                                                    <div class="col-md-5 col-xs-6 col-no-padding-search-input">
                                                        <h:inputText class="form-control input-search" id="actor" value="#{searchProductsManagedBean.actor}" />
                                                    </div>
                                                    <div class="col-xs-1 col-no-padding-search">
                                                        <span class="clean" onclick="clean('actor');">×</span>
                                                    </div>
                                                </div>
                                                <h:panelGroup rendered="#{sessionManagedBean.id ne null}">
                                                    <div class="row" >
                                                        <div class="col-md-6 col-xs-5 col-no-padding-search">
                                                            <h:outputLabel class="label-search" for="hide-own">#{msg['films-search-hide-own']} :</h:outputLabel>
                                                        </div>
                                                        <div class="col-md-5 col-xs-6 col-no-padding-search-input">
                                                            <h:selectBooleanCheckbox id="hide-own" value="#{searchProductsManagedBean.hide_own}" /> 
                                                        </div>

                                                    </div>
                                                </h:panelGroup>
                                                <div class="row">
                                                    <div class="col-md-6 col-xs-5 col-no-padding-search">
                                                        <h:outputLabel class="label-search">#{msg['films-search-genres']} :</h:outputLabel>
                                                    </div>
                                                    <div id="selectANDOR" class="col-md-6 col-xs-7 col-no-padding-search">
                                                        <h:selectOneRadio value="#{searchProductsManagedBean.genresMode}">     
							    <f:selectItem class="itemselect" itemValue="AND" itemLabel="#{msg['films-search-and']}" />
                                                            <f:selectItem class="itemselect" itemValue="OR" itemLabel="#{msg['films-search-or']}" />

                                                        </h:selectOneRadio>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <c:forEach items="#{listProductsManagedBean.getAllGenres()}" var="g" varStatus="loop">
                                                        <div class="col-xs-6 col-checkbox-search">
                                                            <h:selectBooleanCheckbox id="genres-id-#{loop.index}" value="#{searchProductsManagedBean.checked[g.id]}" >
                                                                <f:ajax listener="#{searchProductsManagedBean.majGenres()}" />
                                                            </h:selectBooleanCheckbox>
                                                            <h:outputLabel class="label-genres" for="genres-id-#{loop.index}" >#{g.name}</h:outputLabel>
                                                        </div>
                                                    </c:forEach>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xs-12">
                                                        <h:commandButton onclick="javascript:loader('search');" class="btn btn-success btn-xs btn-search" value="#{msg['films-search-search']}" style="margin-left: -15px;" >
                                                            <f:actionListener binding="#{listProductsManagedBean.setPage(1)}"/>
                                                            <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page"/>
                                                        </h:commandButton>
							<h:commandButton onclick="javascript:loader('search');" class="btn btn-primary btn-xs btn-search" value="#{msg['reset']}" >
                                                            <f:actionListener binding="#{searchProductsManagedBean.reset()}"/>
                                                            <f:ajax execute="@form" render=":form-random :panel-random :form-nav-page"/>
                                                        </h:commandButton>
						    </div>					    
                                                </div>
                                            </div>
                                        </li>
                                        <div class="clear-both"></div>
                                    </ul>
                                </h:form>
                            </div>
                        </div>
                    </aside>
                    <div class="col-lg-9 col-md-8">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3><i class="glyphicon glyphicon-list-alt"/>#{msg['films-search-list']}</h3>
                            </div>
                            <div class="panel-body">
                                <c:set var="list" scope="view" value="#{listProductsManagedBean.getFilms(searchProductsManagedBean.searchParams)}" />
                                <h:panelGroup id="panel-random">
                                    <c:choose>
                                        <c:when test="#{list.size() > 0}" >
                                            <div class="row row-display">
                                                <ui:repeat var="f" value="#{list}">
                                                    <div class="col-lg-4 col-md-6 col-sm-6 col-row-display">
							<div style="position: absolute; margin-left: 50%; padding-left: 40px; width: 10px; margin-top: 20px;">
							    <h:panelGroup rendered="#{listProductsManagedBean.isPack(f.id)}">
								<i class="glyphicon glyphicon-book" title="#{msg['infob-pack']}" />
							    </h:panelGroup>
							    <h:panelGroup rendered="#{sessionManagedBean.isInMyFilms(f.id)}">
								<i class="glyphicon glyphicon-film" title="#{msg['infob-caddie']}"/>
							    </h:panelGroup>
							    <h:panelGroup rendered="#{sessionManagedBean.isInMyCaddie(f.id)}">
								<i class="glyphicon glyphicon-shopping-cart" title="#{msg['infob-buy']}"/>
							    </h:panelGroup>
							</div>


							<a href="#{msg['page-fiche-product']}.xhtml?id=#{f.id}">					
                                                            <span>
                                                                <img class="table-cover-film" src="http://image.tmdb.org/t/p/w92/#{f.cover}" title="#{f.name}"/>
                                                            </span>
                                                            <p class="table-title-film truncate">#{f.name}</p>
                                                        </a>
                                                    </div>
                                                </ui:repeat>
                                            </div>
                                        </c:when>
                                        <c:otherwise>
                                            #{msg['films-search-noresult']}
                                        </c:otherwise>
                                    </c:choose>
                                </h:panelGroup>
                            </div>
                            <div class="panel-footer">
                                <h:form id="form-nav-page" >
                                    <ul class="pagination">
                                        <c:choose>
                                            <c:when test="#{listProductsManagedBean.page eq 1}" >
                                                <li class="disabled cursor-normal"><a href="#" onclick="return false;"><span aria-hidden="true">«</span><span class="sr-only">Previous</span></a></li>
                                            </c:when>
                                            <c:otherwise>
                                                <li>
                                                    <h:commandLink action="#{listProductsManagedBean.setPage(listProductsManagedBean.page-1)}">
                                                        <span aria-hidden="true">«</span><span class="sr-only">Previous</span>
                                                        <f:ajax execute="@form" render=":form-nav-page :panel-random" />
                                                    </h:commandLink>
                                                </li>
                                            </c:otherwise>
                                        </c:choose>
                                        <li class="active cursor-normal"><a href="" onclick="return false;">#{listProductsManagedBean.page}</a></li>
                                        <c:choose>
                                            <c:when test="#{listProductsManagedBean.isLastPage()}" >
                                                <li class="disabled cursor-normal"><a href="#" onclick="return false;"><span aria-hidden="true">»</span><span class="sr-only">Next</span></a></li>
                                            </c:when>
                                            <c:otherwise>
                                                <li>
                                                    <h:commandLink action="#{listProductsManagedBean.setPage(listProductsManagedBean.page+1)}">
                                                        <span aria-hidden="true">»</span><span class="sr-only">Next</span>
                                                        <f:ajax execute="@form" render=":form-nav-page :panel-random" />
                                                    </h:commandLink>
                                                </li>
                                            </c:otherwise>
                                        </c:choose>
                                    </ul>
                                </h:form>
                            </div>				
                        </div>		
                    </div>
                </div>
            </div>
        </section>

        <ui:insert name="footer" >
            <ui:include src="components/footer.xhtml" />
        </ui:insert>
    </h:body>

</html>
