<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" />
	<title>Display films </title>
	<meta name="description" content=""/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>

	<link rel="stylesheet" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/bootstrap-theme.min.css"/>
	<link rel="stylesheet" href="css/main.css"/>
	<link rel="stylesheet" href="css/style-films.css"/>

	<f:metadata>
	    <f:event type="preRenderView" listener="#{sessionManagedBean.checkRight()}"/>
	    <f:viewParam name="n" value="#{searchProductsManagedBean.title}" />
	    <f:viewParam name="form-search" value="#{listProductsManagedBean.searchOpened}" />
	    <f:viewParam name="s" value="#{listProductsManagedBean.tabFilms}" />
	</f:metadata>

    </h:head>

    <h:body>
	<ui:insert name="header" >
	    <ui:include src="components/header.xhtml">
		<ui:param name="active" value="films" />
	    </ui:include>
	</ui:insert>

	<script>
	    function loader(id) {
		document.getElementById('loader-' + id).style.display = 'inline';
	    }
	    function handleAjaxOpen(data) {
		var status = data.status;

		switch (status) {
		    case "success":
			setTimeout(function () {
			    document.getElementById('search-attributs').style.maxHeight = '1000px';
			}, 100);
			break;
		}
	    }
	    function handleAjaxClose(data) {
		var status = data.status;

		switch (status) {
		    case "success":
			setTimeout(function () {
			    document.getElementById('search-attributs').style.maxHeight = '0px';
			}, 100);
			break;
		}
	    }
	</script>

	<section>
	    <div class="container">
		<div class="well">
		    <h2 class="well-title"><strong>Films</strong></h2>

		    <div id="nav-page-left">
			<h:form id="form-random">
			    <p class="#{((listProductsManagedBean.getTabFilms() eq 'all')? 'activated' : '')}">
				<h:commandLink onclick="javascript:loader('all');" value="Tous les films" action="#{listProductsManagedBean.setTabFilms('allLOCALE')}">
				    <f:ajax execute="@form" render=":form-random :panel-random" onevent="handleAjaxClose"/>
				    <img id="loader-all" class="films-loader" src="img/loader.gif"/>
				</h:commandLink>
			    </p>
			    <p class="#{((listProductsManagedBean.getTabFilms() eq 'pack')? 'activated' : '')}">
				<h:commandLink onclick="javascript:loader('pack');" value="Tous les packs" action="#{listProductsManagedBean.setTabFilms('packLOCALE')}">
				    <f:ajax execute="@form" render=":form-random :panel-random" onevent="handleAjaxClose"/>
				    <img id="loader-pack" class="films-loader" src="img/loader.gif"/>
				</h:commandLink>
			    </p>
			    <p class="#{((listProductsManagedBean.getTabFilms() eq 'top')? 'activated' : '')}">
				<h:commandLink onclick="javascript:loader('top');" value="Top 50" action="#{listProductsManagedBean.setTabFilms('topLOCALE')}">
				    <f:ajax execute="@form" render=":form-random :panel-random" onevent="handleAjaxClose"/>
				    <img id="loader-top" class="films-loader" src="img/loader.gif"/>
				</h:commandLink>
			    </p>
			    <p class="#{((listProductsManagedBean.getTabFilms() eq 'new')? 'activated' : '')}">
				<h:commandLink onclick="javascript:loader('new');" value="Nouveautés" action="#{listProductsManagedBean.setTabFilms('newLOCALE')}">
				    <f:ajax execute="@form" render=":form-random :panel-random" onevent="handleAjaxClose"/>
				    <img id="loader-new" class="films-loader" src="img/loader.gif"/>
				</h:commandLink>
			    </p>

			    <p class="#{((listProductsManagedBean.getTabFilms() eq 'search')? 'activated' : '')}">
				<h:commandLink onclick="javascript:loader('search');" value="Recherche avancée" action="#{listProductsManagedBean.setTabFilms('searchLOCALE')}">
				    <f:ajax execute="@form" render=":form-random :panel-random" onevent="handleAjaxOpen"/>
				    <img id="loader-search" class="films-loader" src="img/loader.gif"/>
				</h:commandLink>

				<span id="search-attributs" style="max-height: #{((listProductsManagedBean.searchOpened == 0)? '500' : '0')}px;">
				    <h:outputLabel for="title">Titre :</h:outputLabel><h:inputText class="form-control input-search" id="title" value="#{searchProductsManagedBean.title}" />
				    <h:commandButton rendered="#{searchProductsManagedBean.title != null}" onclick="javascript:loader('search');" class="clean" value="×" action="#{searchProductsManagedBean.setTitle(null)}">
					<f:ajax execute="@form" render=":form-random :panel-random" />
				    </h:commandButton>

				    <h:outputLabel for="date">Date :</h:outputLabel><h:inputText class="form-control input-search" id="date" value="#{searchProductsManagedBean.date}" />
				    <h:commandButton rendered="#{searchProductsManagedBean.date != null}" onclick="javascript:loader('search');" class="clean" value="×" action="#{searchProductsManagedBean.setDate(null)}">
					<f:ajax execute="@form" render=":form-random :panel-random" />
				    </h:commandButton>

				    <h:outputLabel for="director">Réalisateur :</h:outputLabel><h:inputText class="form-control input-search" id="director" value="#{searchProductsManagedBean.director}" />
				    <h:commandButton rendered="#{searchProductsManagedBean.director != null}" onclick="javascript:loader('search');" class="clean" value="×" action="#{searchProductsManagedBean.setDirector(null)}">
					<f:ajax execute="@form" render=":form-random :panel-random" />
				    </h:commandButton>
				    <h:outputLabel for="actor">Acteur :</h:outputLabel><h:inputText class="form-control input-search" id="actor" value="#{searchProductsManagedBean.actor}" />
				    <h:commandButton rendered="#{searchProductsManagedBean.actor != null}" onclick="javascript:loader('search');" class="clean" value="×" action="#{searchProductsManagedBean.setActor(null)}">
					<f:ajax execute="@form" render=":form-random :panel-random" />
				    </h:commandButton>

				    <ui:repeat var="g" value="#{listProductsManagedBean.getAllGenres()}" >
					<h:outputLabel class="label-genres" >#{g.name} :</h:outputLabel>
					<h:selectBooleanCheckbox value="#{searchProductsManagedBean.checked[g.id]}" >
					    <f:ajax listener="#{searchProductsManagedBean.majGenres()}" />
					</h:selectBooleanCheckbox>
				    </ui:repeat>

				    <!-- problème de maj des checkbox -->

				    <h:commandButton onclick="javascript:loader('search');" class="btn btn-success btn-xs btn-search" value="Rechercher">
					<f:ajax execute="@form" render=":form-random :panel-random"/>
				    </h:commandButton>
				</span>
			    </p>
			</h:form>
		    </div>

		    <div class="box-right">
			<h3><img src="img/list-icon.png" title="Produits"/>Liste des produits</h3>

			<c:set var="list" value="#{listProductsManagedBean.getFilms(searchProductsManagedBean.searchParams)}" />
			<c:set var="vide" value="#{empty list}" />

			<h:panelGroup id="panel-random">
			    <h:panelGroup rendered="#{not vide}">
				<table class="table-borderless">
				    <ui:repeat var="o" value="#{list}">
					<tr>
					    <ui:repeat var="f" value="#{o}">
						<td>
						    <a class="table-td-background" href="fiche_product.xhtml?id=#{f.id}">					
							<img class="table-cover-film" src="http://image.tmdb.org/t/p/w396/#{f.cover}" title="#{f.name}"/>				    
							<p class="table-title-film">#{f.name}</p>
						    </a>				
						</td>
					    </ui:repeat>
					</tr>
				    </ui:repeat>
				    <h:outputText value="#{listProductsManagedBean.getEmptyTd(list)}" escape="false" />
				</table>
			    </h:panelGroup>

			    <h:panelGroup rendered="#{vide}">
				Aucun produit ne correspond à votre recherche ...
			    </h:panelGroup>
			</h:panelGroup>
		    </div>

		    <div id="bottom">
			<a class="go-top" href="#top" title="Vers le haut"><img src="img/arrowUp.png" /></a>                        
		    </div>

		</div>

	    </div>
	</section>

	<ui:insert name="footer" >
	    <ui:include src="components/footer.xhtml" />
	</ui:insert>
    </h:body>

</html>
